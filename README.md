# ğŸ® EverSoul æ”»ç•¥ä½œä¸šåˆ†äº«ç«™

ä¸€ä¸ªåŸºäº Next.js 14 + TypeScript + Prisma æ„å»ºçš„ EverSoul æ¸¸æˆæ”»ç•¥åˆ†äº«å¹³å°ï¼Œæ”¯æŒç©å®¶ä¸Šä¼ é€šå…³æˆªå›¾ã€ç®¡ç†å‘˜å®¡æ ¸ã€å¤šæ•°æ®æºåˆ‡æ¢ç­‰åŠŸèƒ½ã€‚

## âœ¨ åŠŸèƒ½ç‰¹æ€§

### ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

- **ğŸ“Š å…³å¡æ•°æ®å±•ç¤º**

  - æ”¯æŒæ­£å¼æœ/æµ‹è¯•æœæ•°æ®æºåˆ‡æ¢
  - è¯¦ç»†çš„å…³å¡ä¿¡æ¯ï¼ˆæ•Œæ–¹é˜µå®¹ã€æˆ˜åŠ›ã€æ‰è½ç‡ç­‰ï¼‰
  - å“åº”å¼å…³å¡åˆ—è¡¨å’Œç« èŠ‚å¯¼èˆª
  - å…³å¡ä¸“å±èƒŒæ™¯å›¾ç‰‡ç³»ç»Ÿ
- **ğŸ“¤ ä½œä¸šä¸Šä¼ ç³»ç»Ÿ**

  - ç”¨æˆ·å‹å¥½çš„ä½œä¸šä¸Šä¼ ç•Œé¢
  - å›¾ç‰‡è‡ªåŠ¨å‹ç¼©ä¼˜åŒ–ï¼ˆSharpï¼‰
  - æ”¯æŒå¤šå›¾ç‰‡ä¸Šä¼ ï¼ˆæ ¹æ®é˜Ÿä¼æ•°é‡è‡ªåŠ¨è°ƒæ•´ï¼‰
  - è¾“å…¥å†…å®¹å®‰å…¨è¿‡æ»¤
- **ğŸ›¡ï¸ ç®¡ç†å‘˜å®¡æ ¸ç³»ç»Ÿ**

  - å®‰å…¨çš„å¯†ç è®¤è¯æœºåˆ¶
  - ä½œä¸šçŠ¶æ€ç®¡ç†ï¼ˆå¾…å®¡æ ¸/é€šè¿‡/æ‹’ç»ï¼‰
  - æ‰¹é‡æ“ä½œå’Œåˆ†é¡µå±•ç¤º
  - æ–‡ä»¶ç³»ç»Ÿè‡ªåŠ¨æ¸…ç†
- **ğŸ¨ ç”¨æˆ·ä½“éªŒ**

  - ç°ä»£åŒ– UI è®¾è®¡ï¼ˆTailwind CSSï¼‰
  - æš—è‰²ä¸»é¢˜é…è‰²æ–¹æ¡ˆ
  - æ¯›ç»ç’ƒæ•ˆæœå’ŒåŠ¨ç”»äº¤äº’
  - ç§»åŠ¨ç«¯å“åº”å¼é€‚é…

### ğŸ”§ æŠ€æœ¯ç‰¹æ€§

- **æ€§èƒ½ä¼˜åŒ–**

  - å›¾ç‰‡æ‡’åŠ è½½å’Œå‹ç¼©
  - æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–
  - é™æ€èµ„æº CDN å‹å¥½
- **å®‰å…¨æ€§**

  - XSS é˜²æŠ¤ï¼ˆè¾“å…¥è¿‡æ»¤ï¼‰
  - æ–‡ä»¶ä¸Šä¼ å®‰å…¨éªŒè¯
  - ä¼šè¯ç®¡ç†å’Œæƒé™æ§åˆ¶
- **å¯ç»´æŠ¤æ€§**

  - TypeScript ç±»å‹å®‰å…¨
  - æ¨¡å—åŒ–ç»„ä»¶è®¾è®¡
  - ç»Ÿä¸€çš„é”™è¯¯å¤„ç†

## ğŸš€ æŠ€æœ¯æ ˆ

### å‰ç«¯æŠ€æœ¯

- **æ¡†æ¶**: Next.js 14 (App Router)
- **è¯­è¨€**: TypeScript 5
- **æ ·å¼**: Tailwind CSS 3
- **UI ç»„ä»¶**: Lucide React (å›¾æ ‡)
- **çŠ¶æ€ç®¡ç†**: React Hooks

### åç«¯æŠ€æœ¯

- **è¿è¡Œæ—¶**: Node.js
- **æ¡†æ¶**: Next.js API Routes
- **æ•°æ®åº“**: SQLite (Prisma ORM)
- **è®¤è¯**: è‡ªå®šä¹‰ JWT ä¼šè¯
- **æ–‡ä»¶å¤„ç†**: Sharp (å›¾ç‰‡å‹ç¼©)

### å¼€å‘å·¥å…·

- **ä»£ç è´¨é‡**: ESLint + TypeScript
- **åŒ…ç®¡ç†**: npm
- **æ•°æ®åº“è¿ç§»**: Prisma
- **æ„å»ºå·¥å…·**: Next.js å†…ç½®

## ğŸ“¦ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Node.js 24+
- npm 11+

### å®‰è£…æ­¥éª¤

1. **å…‹éš†é¡¹ç›®**

```bash
git clone https://github.com/PackageInstaller/EverSoulHomeWork
cd EverSoulHomeWork
```

2. **å®‰è£…ä¾èµ–**

```bash
npm install
npm run build
```

3. **æ•°æ®åº“è®¾ç½®**

```bash
# ç”Ÿæˆ Prisma å®¢æˆ·ç«¯
npx prisma generate

# åˆ›å»ºæ•°æ®åº“å’Œè¡¨ç»“æ„
npx prisma db push
```

4. **é…ç½®ç®¡ç†å‘˜å¯†ç **

```bash
# åˆ›å»ºå¯†ç æ–‡ä»¶
echo "your_admin_password" > admin-secret.txt
```

5. **å¯åŠ¨å¼€å‘æœåŠ¡å™¨**

```bash
npm run dev
```

è®¿é—® [http://localhost:3000](http://localhost:3000) æŸ¥çœ‹åº”ç”¨ã€‚

### ç”Ÿäº§éƒ¨ç½²

```bash
# æ„å»ºé¡¹ç›®
npm run build

# å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨
npm run start
# æˆ–è€…æ¨èpm2å¯åŠ¨
npm intall pm2
pm2 start npm -- start
```

## ğŸ“‚ é¡¹ç›®ç»“æ„

```
EverSoulHomeWork/
â”œâ”€â”€ prisma/
â”‚   â””â”€â”€ schema.prisma          # æ•°æ®åº“æ¨¡å‹å®šä¹‰
â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ images/               # é™æ€å›¾ç‰‡èµ„æº
â”‚   â””â”€â”€ uploads/homework/     # ç”¨æˆ·ä¸Šä¼ çš„ä½œä¸šå›¾ç‰‡
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/                  # Next.js App Router
â”‚   â”‚   â”œâ”€â”€ api/             # API è·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ admin/       # ç®¡ç†å‘˜ API
â”‚   â”‚   â”‚   â””â”€â”€ homework/    # ä½œä¸šç›¸å…³ API
â”‚   â”‚   â”œâ”€â”€ admin/           # ç®¡ç†å‘˜é¡µé¢
â”‚   â”‚   â”œâ”€â”€ stage/           # å…³å¡ç›¸å…³é¡µé¢
â”‚   â”‚   â””â”€â”€ globals.css      # å…¨å±€æ ·å¼
â”‚   â”œâ”€â”€ components/          # React ç»„ä»¶
â”‚   â”œâ”€â”€ config/             # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ lib/                # å·¥å…·åº“
â”‚   â”œâ”€â”€ types/              # TypeScript ç±»å‹å®šä¹‰
â”‚   â””â”€â”€ utils/              # å·¥å…·å‡½æ•°
â”œâ”€â”€ admin-secret.txt         # ç®¡ç†å‘˜å¯†ç ï¼ˆéœ€è¦åˆ›å»ºï¼‰
â””â”€â”€ package.json
```

## ğŸ”Œ API æ¥å£æ–‡æ¡£

### ä½œä¸šç›¸å…³æ¥å£

#### è·å–å…³å¡ä½œä¸š

```http
GET /api/homework/[stageId]
```

- **å‚æ•°**: `stageId` - å…³å¡IDï¼ˆå¦‚ "1-1"ï¼‰
- **è¿”å›**: å·²å®¡æ ¸é€šè¿‡çš„ä½œä¸šåˆ—è¡¨

#### ä¸Šä¼ ä½œä¸š

```http
POST /api/homework/upload
```

- **Content-Type**: `multipart/form-data`
- **å‚æ•°**:
  - `stageId`: å…³å¡ID
  - `nickname`: ç”¨æˆ·æ˜µç§°
  - `description`: ä½œä¸šæè¿°ï¼ˆå¯é€‰ï¼‰
  - `teamCount`: é˜Ÿä¼æ•°é‡
  - `images`: å›¾ç‰‡æ–‡ä»¶æ•°ç»„

### ç®¡ç†å‘˜æ¥å£

#### ç®¡ç†å‘˜è®¤è¯

```http
POST /api/admin/auth      # ç™»å½•
GET /api/admin/auth       # éªŒè¯ä¼šè¯
DELETE /api/admin/auth    # ç™»å‡º
```

#### ä½œä¸šç®¡ç†

```http
GET /api/admin/homework                    # è·å–ä½œä¸šåˆ—è¡¨
PATCH /api/admin/homework/[id]            # æ›´æ–°ä½œä¸šçŠ¶æ€
DELETE /api/admin/homework/[id]           # åˆ é™¤ä½œä¸š
```

### CDN ç¼“å­˜é…ç½®

**éœ€è¦ç¦ç”¨ç¼“å­˜çš„æ¥å£**:

- `/api/admin/*` - æ‰€æœ‰ç®¡ç†å‘˜æ¥å£
- `/api/homework/upload` - ä½œä¸šä¸Šä¼ æ¥å£

**å¯ä»¥ç¼“å­˜çš„æ¥å£**:

- `/api/homework/[stageId]` - ä½œä¸šå±•ç¤ºæ¥å£ï¼ˆå»ºè®®5-15åˆ†é’Ÿç¼“å­˜ï¼‰

## ğŸ—„ï¸ æ•°æ®åº“æ¨¡å‹

### UserHomeworkï¼ˆç”¨æˆ·ä½œä¸šï¼‰

- `id`: å”¯ä¸€æ ‡è¯†ç¬¦
- `stageId`: å…³å¡ID
- `nickname`: ç”¨æˆ·æ˜µç§°
- `description`: ä½œä¸šæè¿°
- `teamCount`: é˜Ÿä¼æ•°é‡
- `status`: å®¡æ ¸çŠ¶æ€ï¼ˆpending/approved/rejectedï¼‰
- `createdAt/updatedAt`: æ—¶é—´æˆ³

### HomeworkImageï¼ˆä½œä¸šå›¾ç‰‡ï¼‰

- `id`: å”¯ä¸€æ ‡è¯†ç¬¦
- `homeworkId`: å…³è”ä½œä¸šID
- `filename`: å­˜å‚¨æ–‡ä»¶å
- `originalName`: åŸå§‹æ–‡ä»¶å
- `fileSize`: æ–‡ä»¶å¤§å°
- `order`: å›¾ç‰‡é¡ºåº

## ğŸ”§ é…ç½®è¯´æ˜

### ç®¡ç†å‘˜å¯†ç é…ç½®

åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `admin-secret.txt` æ–‡ä»¶ï¼š

```
your_secure_password_here
```

### ç¯å¢ƒå˜é‡ï¼ˆå¯é€‰ï¼‰

```env
# æ•°æ®åº“è¿æ¥ï¼ˆé»˜è®¤ä½¿ç”¨ SQLiteï¼‰
DATABASE_URL="file:./dev.db"

# Node ç¯å¢ƒ
NODE_ENV="production"
```

### Next.js é…ç½®

```javascript
// next.config.js
const nextConfig = {
  images: {
    domains: ['raw.githubusercontent.com'], // å¤–éƒ¨å›¾ç‰‡åŸŸå
  },
}
```

## ğŸ› ï¸ å¼€å‘æŒ‡å—

### æœ¬åœ°å¼€å‘

```bash
# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev

# ç±»å‹æ£€æŸ¥
npm run lint

# æ•°æ®åº“é‡ç½®
npx prisma db push --force-reset
```
